<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Hallusinaattori Part Deux</title>
<style>
#customize {position: absolute;
            top: 10%; left: 10%;
            width: 40%; height: 20%;
            background-color: #222;
            color: #FFF;
            padding: 5px; }
#customize table {
            border: 1px solid #FFF;
            width: 100%}
#customize table td {
            text-align: center;}
#picker { width: 70px; height: 70px; cursor: crosshair; float: left }
#slide { width: 15px; height: 70px }
</style>
<link rel="stylesheet" href="themes.css">
<script language="javascript" src="gee.min.js"></script>
<script type="text/javascript" src="colorpicker.min.js"></script>
<script language="javascript">
speed = 2;
wwidth = 15;
ring = 250;
dir = 1;
background = '';
window.onload = function() {
    var cpanel = document.getElementById('customize');
    cpanel.style.visibility = 'hidden';
    var g = new GEE( { fullscreen: true } );
    g,frameRate = 15;

    var start = 0;
    var showPanel = 0;

    g.draw = function() {
        g.ctx.fillStyle = '#000';
        g.ctx.fillText( g.frameCount, 10, 10 );
        g.ctx.clearRect( 0, 0, g.width, g.height );

        if (background)
            g.ctx.fillStyle = background;
        else
            g.ctx.fillStyle = get_spectrum(g.frameCount);
        g.ctx.fillRect( 0, 0, g.width, g.height );
        spiral(start, wwidth, ring, dir, g);
        start = start + speed;
        if (showPanel) {
            update_values();
        }
    };
    g.keydown = function() {
        console.log(g.key + " " + g.keyCode);
        if (g.keyCode == 67) {
            if (showPanel) {
                cpanel.style.visibility = 'hidden';
                showPanel = 0;
            } else {
                cpanel.style.visibility = 'visible';
                showPanel = 1;
            }
        }
    }
};
function spiral(frame, width, ring, dir, g)
{
    var midx = g.width / 2;
    var midy = g.height / 2;

    var sep = width * 2;
    var start = dir * (frame % sep);

    g.ctx.lineWidth = width;
    for (var i=ring + start - 15; i > 0; i-=sep)
    {
        g.ctx.beginPath();
        g.ctx.arc(midx,midy,i,0,2*Math.PI,0);
        g.ctx.closePath();
        g.ctx.stroke();
    }
    for (var i=midx + (5 * sep) - start; i > ring; i-=sep)
    {
        g.ctx.beginPath();
        g.ctx.arc(midx,midy,i,0,2*Math.PI,0);
        g.ctx.closePath();
        g.ctx.stroke();
    }
}
function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
}
function get_spectrum(frame) {
    var val = frame % 1536;
    var red = 255;
    var green = 0;
    var blue = 0;
    if (val < 256) {
        red = 255;
        green = 0;
        blue = val;
    } else if (val >= 256 && val < 512) {
        red = 255 - (val % 256);
        green = 0;
        blue = 255;
    } else if (val >= 512 && val < 768) {
        red = 0;
        green = val % 256;
        blue = 255;
    } else if (val >= 768 && val < 1024) {
        red = 0;
        green = 255;
        blue = 255 - (val % 256);
    } else if (val >= 1024 && val < 1280) {
        red = val % 256;
        green = 255;
        blue = 0;
    } else if (val >= 1280 && val < 1536) {
        red = 255;
        green = 255 - (val % 256);
        blue = 0;
    }
    return "#" + componentToHex(red) + componentToHex(green) + componentToHex(blue);
}
function update_values()
{
    var speed_value = document.getElementById('speed_value');
    var width_value = document.getElementById('width_value');
    var ring_value = document.getElementById('ring_value');

    speed_value.value = speed;
    width_value.value = wwidth;
    ring_value.value = ring;
}
</script>
</head>
<body>
    <div id="customize">
    <table>
        <tr>
            <td>width</td>
            <td>speed</td>
            <td>ring</td>
            <td>direction</td>
            <td>background</td>
        </tr>
        <tr>
            <td><input type="button" value="↑" id="width_up" onclick="wwidth += 5"><br>
                <input type="text" value="" id="width_value" size=5><br>
                <input type="button" value="↓" id="width_dn" onclick="wwidth -= 5"></td>
            <td><input type="button" value="↑" id="speed_up" onclick="speed += 0.5"><br>
                <input type="text" value="" id="speed_value" size=5><br>
                <input type="button" value="↓" id="speed_dn" onclick="speed -= 0.5"></td>
            <td><input type="button" value="↑" id="ring_up" onclick="ring += 10"><br>
                <input type="text" value="" id="ring_value" size=5><br>
                <input type="button" value="↓" id="ring_dn" onclick="ring -= 10"></td>
            <td><input type="radio" name="dir" value="1" onclick="dir = 1"> Out<br>
                <input type="radio" name="dir" value="-1" onclick="dir = -1"> In</td>
            <td>
                <div class="cp-small">
                    <div class="picker-wrapper">
                        <div class="picker" id='picker'></div>
                        <div class="picker-indicator" id='picker-indicator'></div>
                    </div>
                    <div class="slide-wrapper">
                        <div class="slide" id='slide'></div>
                        <div class="slide-indicator" id='slide-indicator'></div>
                    </div>
                </div>
                <script type="text/javascript">
                  var c = ColorPicker(
                    document.getElementById('slide'),
                    document.getElementById('picker'));
                  c.callback = function(hex, hsv, rgb, mousePicker, mouseSlide) {                                                      
                        ColorPicker.positionIndicators(
                            document.getElementById('slide-indicator'),document.getElementById('picker-indicator'),
                            mouseSlide, mousePicker
                        );
                        background = hex;
                    };

                </script></td>
        </tr>
    </table>
    </div>
</body>
</html>
